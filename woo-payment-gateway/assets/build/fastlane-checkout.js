/*! For license information please see fastlane-checkout.js.LICENSE.txt */
!function(){var e={567:function(e){"use strict";e.exports=window.jQuery},819:function(e){"use strict";e.exports=window.lodash},483:function(e){"use strict";e.exports=window.wp.url}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}var t,r=(t=n(567))&&t.__esModule?t:{default:t},a=n(819),i=n(483),o=["selectedAddress"];function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(){"use strict";d=function(){return t};var t={},n=Object.prototype,r=n.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var a=t&&t.prototype instanceof h?t:h,i=Object.create(a.prototype),o=new E(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(a,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw i;return{value:void 0,done:!0}}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var s=_(o,n);if(s){if(s===p)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=u(e,t,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===p)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}(e,n,o),i}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=c;var p={};function h(){}function f(){}function m(){}var v={};l(v,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(S([])));g&&g!==n&&r.call(g,i)&&(v=g);var b=m.prototype=h.prototype=Object.create(v);function k(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function w(t,n){function a(i,o,s,l){var c=u(t[i],t,o);if("throw"!==c.type){var d=c.arg,p=d.value;return p&&"object"==e(p)&&r.call(p,"__await")?n.resolve(p.__await).then((function(e){a("next",e,s,l)}),(function(e){a("throw",e,s,l)})):n.resolve(p).then((function(e){d.value=e,s(d)}),(function(e){return a("throw",e,s,l)}))}l(c.arg)}var i;this._invoke=function(e,t){function r(){return new n((function(n,r){a(e,t,n,r)}))}return i=i?i.then(r,r):r()}}function _(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,_(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var r=u(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,p;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function S(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:T}}function T(){return{value:void 0,done:!0}}return f.prototype=m,l(b,"constructor",m),l(m,"constructor",f),f.displayName=l(m,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,l(e,s,"GeneratorFunction")),e.prototype=Object.create(b),e},t.awrap=function(e){return{__await:e}},k(w.prototype),l(w.prototype,o,(function(){return this})),t.AsyncIterator=w,t.async=function(e,n,r,a,i){void 0===i&&(i=Promise);var o=new w(c(e,n,r,a),i);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},k(b),l(b,s,"Generator"),l(b,i,(function(){return this})),l(b,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=S,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),l=r.call(i,"finallyLoc");if(s&&l){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),C(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;C(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:S(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},t}function p(e,t,n,r,a,i,o){try{var s=e[i](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,a)}function h(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){p(i,r,a,o,s,"next",e)}function s(e){p(i,r,a,o,s,"throw",e)}o(void 0)}))}}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var m=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.settings=t.settings,this.components={},this.currentCard=null,this.canceledEmails=[],this.customerContextId=null}var t,n,l,u,p,m,v,y,g,b,k,w,_,x;return t=e,n=[{key:"create_instance",value:function(e,t){this.client=e,this.clientToken=t,this.initialize()}},{key:"initialize",value:(x=h(d().mark((function e(){var t;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.addActions(),e.next=3,this.initializeDataCollector();case 3:return e.next=5,this.createFastlaneInstance();case 5:return t=[],this.isEmailDetectionEnabled()&&t.push(this.mountFastlaneWatermark()),t.push(this.authenticateOnPageLoad()),e.next=10,Promise.all(t);case 10:(0,r.default)(".wc_braintree_banner_gateway_braintree_cc").css("max-width",(0,r.default)(".woocommerce-billing-fields").outerWidth(!0));case 11:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)})},{key:"addActions",value:function(){(0,r.default)(document.body).on("updated_checkout",this.onUpdatedCheckout.bind(this)),(0,r.default)(document.body).on("input",'[name="billing_email"]',this.onEmailChange.bind(this)),(0,r.default)(document.body).on("click",".wc-ppcp-fastlane-button",this.onFastlaneClick.bind(this)),(0,r.default)(document.body).on("click",".wc-ppcp-fastlane-cancel",this.onCloseModal.bind(this)),(0,r.default)(document.body).on("click",".wc-ppcp-fastlane-tokenize",this.onPaymentTokenize.bind(this)),(0,r.default)(document.body).on("click",".wc-ppcp-tokenized-card-cancel",this.cancelTokenizedPayment.bind(this)),(0,r.default)(document.body).on("click",".wc-ppcp-tokenized-card-change",this.changePaymentMethod.bind(this)),(0,r.default)(document.body).on("click",".fastlane-signup-link-container",this.openFastlaneModal.bind(this)),(0,r.default)(document.body).on("blur",".wc-ppcp-fastlane-modal-field",(function(e){(0,r.default)(e.currentTarget).removeClass("focused")})),(0,r.default)(document.body).on("keyup",".wc-ppcp-fastlane-modal-input",(function(e){(0,r.default)(e.currentTarget).val()?(0,r.default)(e.currentTarget).addClass("not-empty"):(0,r.default)(e.currentTarget).removeClass("not-empty")}))}},{key:"hasComponents",value:function(){return Object.keys(this.components).length>0}},{key:"isEmailDetectionEnabled",value:function(){return"email_detection"===this.settings.fastlane_flow}},{key:"initializeDataCollector",value:(_=h(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,braintree.dataCollector.create({client:this.client});case 3:this.dataCollector=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.info("Error setting up data collector.");case 9:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return _.apply(this,arguments)})},{key:"createFastlaneInstance",value:(w=h(d().mark((function e(){var t,n,a,i,o,s;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,braintree.fastlane.create(c({authorization:this.clientToken},this.dataCollector&&{deviceData:this.dataCollector.deviceData}));case 3:(t=e.sent)&&(n=t.identity,a=t.profile,i=t.FastlanePaymentComponent,o=t.FastlaneCardComponent,s=t.FastlaneWatermarkComponent,this.identity=n,this.profile=a,this.components={FastlanePaymentComponent:i,FastlaneCardComponent:o,FastlaneWatermarkComponent:s}),e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(0),console.info("Error creating fastlane instance. ",e.t0),e.abrupt("return",this.submitError(e.t0,(0,r.default)("form.checkout")));case 11:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return w.apply(this,arguments)})},{key:"onUpdatedCheckout",value:(k=h(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentCard&&this.displayTokenizedCard(this.mapFromTokenToCard(this.currentCard)),!this.isEmailDetectionEnabled()){e.next=4;break}return e.next=4,this.mountFastlaneWatermark();case 4:case"end":return e.stop()}}),e,this)}))),function(){return k.apply(this,arguments)})},{key:"onPaymentTokenize",value:(b=h(d().mark((function e(t){var n,a,i,o,s,l;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.paymentComponent){e.next=25;break}return(n=(0,r.default)(t.currentTarget)).prop("disabled",!0),e.prev=3,e.next=6,this.paymentComponent.getPaymentToken();case 6:if(o=e.sent,this.currentCard=o,this.displayTokenizedCard(this.mapFromTokenToCard(this.currentCard)),this.prepareCardGatewayForCheckout(this.currentCard),this.onCloseModal(),null==o||null===(a=o.paymentSource)||void 0===a||null===(i=a.card)||void 0===i||!i.billingAddress){e.next=16;break}return s=o.paymentSource.card.billingAddress,o.paymentSource.card.billingAddress.toBtSdkType?s=o.paymentSource.card.billingAddress.toBtSdkType():(l=this.extractFullName(o.paymentSource.card.name),s=c({firstName:l[0],lastName:l[1]},s),this.populateShippingAddress(s)),e.next=16,this.updateBillingAddress(s);case 16:this.scrollToPlaceOrder(),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(3),this.submitError(e.t0,(0,r.default)("form.checkout"),"checkout");case 22:return e.prev=22,n.prop("disabled",!1),e.finish(22);case 25:case"end":return e.stop()}}),e,this,[[3,19,22,25]])}))),function(e){return b.apply(this,arguments)})},{key:"mountFastlaneWatermark",value:(g=h(d().mark((function e(){var t;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasComponents()){e.next=14;break}if(e.prev=1,!(0,r.default)("#billing_email_field").length){e.next=9;break}if((0,r.default)("#billing_email_field #wc-ppcp-watermark-container").length){e.next=9;break}return e.next=6,this.components.FastlaneWatermarkComponent({includeAdditionalInfo:!0});case 6:t=e.sent,(0,r.default)("#billing_email_field").append('<div id="wc-ppcp-watermark-container"></div>'),t.render("#wc-ppcp-watermark-container");case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),console.info("Error mounting watermark. Reason: ",e.t0);case 14:case"end":return e.stop()}}),e,this,[[1,11]])}))),function(){return g.apply(this,arguments)})},{key:"authenticateOnPageLoad",value:(y=h(d().mark((function e(){var t;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("1"!==this.settings.fastlane_pageload||!(0,r.default)("#billing_email").length){e.next=5;break}if(t=(0,r.default)("#billing_email").val(),!(0,i.isEmail)(t)){e.next=5;break}return e.next=5,this.triggerAuthentication(t,!1);case 5:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"onEmailChange",value:(v=h(d().mark((function e(t){var n=this;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.isEmailDetectionEnabled()&&(clearTimeout(this.emailTimeout),this.emailTimeout=setTimeout(h(d().mark((function e(){var a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(0,r.default)(t.currentTarget).val(),n.canceledEmails.includes(a)){e.next=8;break}if(!(0,i.isEmail)(a)){e.next=6;break}return e.next=5,n.triggerAuthentication(a,!1);case 5:n.canceledEmails.includes(a)||n.showSignupLink();case 6:e.next=9;break;case 8:n.hideSignupLink();case 9:case"end":return e.stop()}}),e)}))),250));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"onFastlaneClick",value:(m=h(d().mark((function e(t){var n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),this.$button=(0,r.default)(t.currentTarget),n=(0,r.default)("#billing_email").val(),e.prev=3,this.$button.addClass("processing").prop("disabled",!0),this.validateEmail(n),e.next=8,this.triggerAuthentication(n);case 8:e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(3),e.abrupt("return",this.submitError(e.t0,(0,r.default)("form.checkout")));case 13:return e.prev=13,this.$button&&this.$button.removeClass("processing").prop("disabled",!1),e.finish(13);case 16:case"end":return e.stop()}}),e,this,[[3,10,13,16]])}))),function(e){return m.apply(this,arguments)})},{key:"triggerAuthentication",value:(p=h(d().mark((function e(t){var n,a,i,l,u,p,h,f,m,v,y,g,b,k,w,_=arguments;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(_.length>1&&void 0!==_[1])||_[1],e.prev=1,this.authenticationState=null,e.next=5,this.identity.lookupCustomerByEmail(t);case 5:if(a=e.sent,!(i=a.customerContextId)){e.next=43;break}return this.customerContextId=i,e.next=11,this.identity.triggerAuthenticationFlow(i);case 11:if(l=e.sent,u=l.profileData,p=l.authenticationState,this.authenticationState=p,"canceled"!==p){e.next=20;break}this.canceledEmails.push(t),this.hideSignupLink(),e.next=41;break;case 20:if("succeeded"!==p){e.next=41;break}if(v=u.name,y=u.card,g=u.shippingAddress,this.currentCard=y,!this.needsShipping()){e.next=34;break}return e.next=26,this.profile.showShippingAddressSelector();case 26:if(b=e.sent,k=b.selectedAddress,s(b,o),k){e.next=33;break}return this.canceledEmails.push(t),this.hideSignupLink(),e.abrupt("return");case 33:g=k;case 34:if(null!=y&&null!==(h=y.paymentSource)&&void 0!==h&&null!==(f=h.card)&&void 0!==f&&f.billingAddress&&(m=y.paymentSource.card.billingAddress,this.populateBillingAddress(c(c(c({},v),m),{},{phoneNumber:(null===(w=g)||void 0===w?void 0:w.phoneNumber)||null}))),!g||!this.needsShipping()){e.next=38;break}return e.next=38,this.updateShippingAddress(g,m);case 38:this.prepareCardGatewayForCheckout(y),this.displayTokenizedCard(this.mapFromTokenToCard(y)),this.scrollToPlaceOrder();case 41:e.next=46;break;case 43:if(!n){e.next=46;break}return e.next=46,this.openFastlaneModal();case 46:e.next=51;break;case 48:e.prev=48,e.t0=e.catch(1),this.submitError(e.t0,(0,r.default)("form.checkout"));case 51:case"end":return e.stop()}}),e,this,[[1,48]])}))),function(e){return p.apply(this,arguments)})},{key:"openFastlaneModal",value:(u=h(d().mark((function e(){var t=this;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.customerContextId=null,e.next=3,this.components.FastlanePaymentComponent(c({},this.needsShipping()&&{shippingAddress:this.getFastlaneShippingAddress()}));case 3:return this.paymentComponent=e.sent,this.$modal=(0,r.default)(this.settings.html.modal),(0,r.default)(document.body).prepend(this.$modal),(0,r.default)(document.body).addClass("fastlane-modal-open"),this.$modal.find(".wc-ppcp-fastlane-modal-field").on("mousedown",(function(e){(0,r.default)(e.currentTarget).addClass("focused")})),e.next=10,this.paymentComponent.render(".wc-ppcp-fastlane-modal-body");case 10:setTimeout((function(){t.$modal.addClass("active")}),10);case 11:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"onCloseModal",value:function(){var e=this;this.$modal&&(this.$modal.removeClass("active"),setTimeout((function(){e.$modal.remove(),e.$modal=null,(0,r.default)(document.body).removeClass("fastlane-modal-open")}),400))}},{key:"getFastlaneShippingAddress",value:function(){return{firstName:(0,r.default)("#shipping_first_name").val(),lastName:(0,r.default)("#shipping_last_name").val(),streetAddress:(0,r.default)("#shipping_address_1").val(),extendedAddress:(0,r.default)("#shipping_address_2").val(),locality:(0,r.default)("#shipping_city").val(),region:(0,r.default)("#shipping_state").val(),postalCode:(0,r.default)("#shipping_postcode").val(),countryCodeAlpha2:(0,r.default)("#shipping_country").val(),phoneNumber:(0,r.default)("#billing_phone").val()}}},{key:"mapFromTokenToCard",value:function(e){var t=e.paymentSource.card;return{brand:t.brand,card_type:t.brand,last4:t.lastDigits,expiry:t.expiry}}},{key:"displayTokenizedCard",value:function(e){var t=this.formatPaymentMethod(this.settings.payment_format,e);if(this.$card&&(this.$card.remove(),this.$card=null),this.$card=(0,r.default)(this.settings.html.tokenized_card),this.customerContextId&&this.$card.addClass("has-customer-context"),this.$card.find(".wc-ppcp-tokenized-card-format").text(t),this.settings.icons[e.brand.toLowerCase()]){var n=this.settings.icons[e.brand.toLowerCase()];this.$card.find(".wc-ppcp-tokenized-card-icon-container img").attr("src",n)}(0,r.default)(".payment_box.payment_method_braintree_cc .wc-braintree-payment-gateway").hide(),(0,r.default)(".payment_box.payment_method_braintree_cc .wc-braintree-payment-gateway").after(this.$card)}},{key:"cancelTokenizedPayment",value:function(){if(this.currentCard=null,this.authenticationState=null,this.$card){this.$card.remove(),this.$card=null,(0,r.default)(".payment_box.payment_method_braintree_cc .wc-braintree-payment-gateway").show(),(0,r.default)("#braintree_cc_nonce_key").val("");var e=wc_braintree.get_payment_method("braintree_cc");e.set_is_fastlane(!1),e.payment_method_received=!1}}},{key:"changePaymentMethod",value:(l=h(d().mark((function e(){var t,n,a,i;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.profile.showCardSelector();case 3:if(t=e.sent,n=t.selectedCard,t.selectionChanged,!n){e.next=13;break}if(this.cancelTokenizedPayment(),this.prepareCardGatewayForCheckout(n),this.displayTokenizedCard(this.mapFromTokenToCard(n)),null==n||null===(a=n.paymentSource)||void 0===a||null===(i=a.card)||void 0===i||!i.billingAddress){e.next=13;break}return e.next=13,this.updateBillingAddress(n.paymentSource.card.billingAddress);case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),this.submitError(e.t0,(0,r.default)("form.checkout"));case 18:case"end":return e.stop()}}),e,this,[[0,15]])}))),function(){return l.apply(this,arguments)})},{key:"populateBillingAddress",value:function(e){var t={firstName:(0,r.default)("#billing_first_name").val(),lastName:(0,r.default)("#billing_last_name").val(),phoneNumber:(0,r.default)("#billing_phone").val()};(0,r.default)("#billing_first_name").val((null==e?void 0:e.firstName)||t.firstName),(0,r.default)("#billing_last_name").val((null==e?void 0:e.lastName)||t.lastName),(0,r.default)("#billing_address_1").val((null==e?void 0:e.streetAddress)||""),(0,r.default)("#billing_address_2").val((null==e?void 0:e.extendedAddress)||""),(0,r.default)("#billing_postcode").val((null==e?void 0:e.postalCode)||""),(0,r.default)("#billing_city").val((null==e?void 0:e.locality)||""),(0,r.default)("#billing_state").val((null==e?void 0:e.region)||""),(0,r.default)("#billing_country").val((null==e?void 0:e.countryCodeAlpha2)||""),(0,r.default)("#billing_phone").val((null==e?void 0:e.phoneNumber)||t.phoneNumber)}},{key:"populateShippingAddress",value:function(e){(0,r.default)("#shipping_first_name").val((null==e?void 0:e.firstName)||""),(0,r.default)("#shipping_last_name").val((null==e?void 0:e.lastName)||""),(0,r.default)("#shipping_address_1").val((null==e?void 0:e.streetAddress)||""),(0,r.default)("#shipping_address_2").val((null==e?void 0:e.extendedAddress)||""),(0,r.default)("#shipping_postcode").val((null==e?void 0:e.postalCode)||""),(0,r.default)("#shipping_city").val((null==e?void 0:e.locality)||""),(0,r.default)("#shipping_state").val((null==e?void 0:e.region)||""),(0,r.default)("#shipping_country").val((null==e?void 0:e.countryCodeAlpha2)||""),(0,r.default)("#shipping_phone").val((null==e?void 0:e.phoneNumber)||"")}},{key:"updateBillingAddress",value:function(e){var t=this;return new Promise((function(n){t.populateBillingAddress(e),(0,r.default)(document.body).one("updated_checkout",(function(){n(!0)})),(0,r.default)(document.body).trigger("update_checkout")}))}},{key:"updateShippingAddress",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise((function(i){t.populateShippingAddress(e),n&&!(0,a.isEqual)(n,e)&&((0,r.default)('[name="ship_to_different_address"]').is(":checked")||(0,r.default)('[name="ship_to_different_address"]').trigger("click")),(0,r.default)(document.body).one("updated_checkout",(function(){i(!0)})),(0,r.default)(document.body).trigger("update_checkout")}))}},{key:"prepareCardGatewayForCheckout",value:function(e){var t=wc_braintree.get_payment_method("braintree_cc");t.set_is_fastlane(!0),t.payment_method_received=!0,(0,r.default)("#braintree_cc_nonce_key").val(e.id),(0,r.default)('input[name="payment_method"][value="braintree_cc"]').trigger("click"),(0,r.default)("#braintree_cc_use_nonce").trigger("click")}},{key:"validateEmail",value:function(e){if(!e)throw new Error(this.settings.i18n.email_empty);if(!(0,i.isEmail)(e))throw new Error(this.settings.i18n.email_invalid)}},{key:"scrollToPlaceOrder",value:function(){var e=(0,r.default)("#place_order");e.length&&(0,r.default)("html, body").animate({scrollTop:e.offset().top-200},1e3)}},{key:"needsShipping",value:function(){return this.settings.needs_shipping}},{key:"formatPaymentMethod",value:function(e,t){var n={};Object.keys(t).forEach((function(e){n["{".concat(e,"}")]=t[e]}));var r=e;return Object.keys(n).forEach((function(e){for(;r.includes(e);)r=r.replace(e,n[e])})),r}},{key:"submitError",value:function(e,t){(0,r.default)(document.body).triggerHandler("wc_braintree_submit_error",{error:e,element:t,ignore:!0})}},{key:"extractFullName",value:function(e){return[e.split(" ").slice(0,-1).join(" "),e.split(" ").pop()]}},{key:"hideSignupLink",value:function(){(0,r.default)(".fastlane-signup-link-container").hide()}},{key:"showSignupLink",value:function(){(0,r.default)(".fastlane-signup-link-container").show()}}],n&&f(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();wc_braintree.register((function(){return new m({settings:wc_braintree_fastlane_params})}))}()}();
//# sourceMappingURL=fastlane-checkout.js.map